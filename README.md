# cargo-doc-viewer

[![Rust](https://img.shields.io/badge/rust-stable-brightgreen.svg)](https://www.rust-lang.org/)
[![License](https://img.shields.io/badge/license-MIT%2FApache--2.0-blue.svg)](LICENSE)

一个增强 Rust 文档浏览体验的工具，为 `cargo doc` 生成的 HTML 文件注入交互式界面组件。

A tool that enhances Rust documentation browsing experience by injecting interactive UI components into HTML files generated by `cargo doc`.

## ✨ 特性 Features

### 🔍 增强搜索 Enhanced Search
- **固定顶部搜索栏** - 保持搜索功能始终可见
- **搜索结果筛选** - 按类型筛选搜索结果（方法/函数/结构体/枚举/Trait/宏/常量/类型/模块）
- **搜索历史** - 自动保存和恢复搜索历史

### 🧭 智能导航 Smart Navigation
- **Home 导航下拉菜单** - 快速返回当前包首页或查看所有包概览
- **函数下拉选择器** - 在顶部快速选择当前页面的函数
- **符号面板** - 按类别组织的页面符号列表
- **键盘导航** - 使用快捷键在标题间导航

### 💬 AI 聊天助手 AI Chat Assistant
- **页面相关问答** - 基于当前文档内容的智能问答
- **文本检索** - 自动从当前页面提取相关内容
- **简洁界面** - 类似 LLM 的聊天界面

### 🎨 用户体验改进 UX Improvements
- **专注模式** - 隐藏干扰元素，专注阅读文档
- **代码复制按钮** - 一键复制代码块
- **标题深链接** - 点击复制标题链接，高亮显示
- **滚动位置记忆** - 刷新页面后恢复滚动位置
- **响应式设计** - 适配各种屏幕尺寸

### 🔧 开发者友好 Developer Friendly
- **幂等操作** - 可安全多次运行，自动检测已注入内容
- **轻松撤销** - 使用 `--revert` 参数移除所有注入的增强功能
- **离线工作** - 无需网络连接，所有功能本地运行
- **最小依赖** - 主要使用 Rust 标准库，构建快速可靠

## 🚀 快速开始 Quick Start

### 安装 Installation

```bash
# 克隆仓库
git clone https://github.com/your-username/cargo-doc-viewer.git
cd cargo-doc-viewer

# 构建发布版本
cargo build --release

# 可选：安装到系统路径
cargo install --path .
```

### 基本使用 Basic Usage

1. **生成文档** Generate documentation:
   ```bash
   cargo doc
   ```

2. **增强文档** Enhance documentation:
   ```bash
   cargo-doc-viewer
   # 或者指定文档目录
   cargo-doc-viewer --doc-dir target/doc
   ```

3. **打开增强后的文档** Open enhanced documentation:
   ```bash
   open target/doc/your_crate/index.html
   ```

4. **撤销增强** Revert enhancements:
   ```bash
   cargo-doc-viewer --revert
   ```

### 命令行选项 Command Line Options

```
cargo-doc-viewer [enhance] [-d|--doc-dir <path>] [--revert]

OPTIONS:
    -d, --doc-dir <path>    指定文档目录 (默认: target/doc)
    --revert               移除之前注入的增强功能
    -h, --help             显示帮助信息

EXAMPLES:
    cargo doc && cargo-doc-viewer
    cargo-doc-viewer --doc-dir custom/doc/path
    cargo-doc-viewer --revert --doc-dir target/doc
```

## 🛠️ 工作原理 How It Works

cargo-doc-viewer 采用**后处理方法**，直接修改 rustdoc 生成的 HTML 文件：

1. **扫描 HTML 文件** - 递归遍历文档目录，查找所有 `.html` 文件
2. **注入 CSS/JS** - 在 `<head>` 中注入样式，在 `</body>` 前注入 JavaScript
3. **添加标记** - 使用 `<!-- CDV: injected -->` 标记确保幂等性
4. **保持兼容** - 完全兼容原生 rustdoc 功能，只是增强用户体验

### 架构特点 Architecture Features

- ✅ **文件就地修改** - 直接修改现有 HTML，无需额外服务器
- ✅ **标记系统** - 智能检测已注入内容，避免重复注入
- ✅ **最小依赖** - 主要使用 Rust 标准库 + bytes crate
- ✅ **离线运行** - 所有功能都在本地运行，无需网络

## 🎯 使用场景 Use Cases

### 日常开发 Daily Development
```bash
# 开发工作流
cargo doc && cargo-doc-viewer
open target/doc/my_crate/index.html
```

### 文档审查 Documentation Review
```bash
# 为团队审查增强文档体验
cargo doc --document-private-items
cargo-doc-viewer --doc-dir target/doc
```

### 演示和教学 Presentations & Teaching
```bash
# 为演示或教学准备增强的文档
cargo doc --examples
cargo-doc-viewer
# 使用专注模式进行演示
```

## 🔧 自定义和扩展 Customization & Extension

### URL 参数 URL Parameters

在文档 URL 中添加参数来控制功能：

- `?cdv-notop` - 禁用顶部搜索栏
- `?cdv-nochat` - 禁用 AI 聊天功能
- `?cdv-nosym` - 禁用符号面板

示例：`target/doc/my_crate/index.html?cdv-notop&cdv-nochat`

### 本地存储 Local Storage

工具使用 localStorage 保存用户偏好：

- 搜索历史和筛选设置
- 专注模式状态
- 滚动位置记忆

键名按文档根路径和包名作用域区分。

## 🤝 贡献 Contributing

我们欢迎各种形式的贡献！

### 开发环境设置 Development Setup

```bash
git clone https://github.com/your-username/cargo-doc-viewer.git
cd cargo-doc-viewer

# 运行检查
cargo check

# 测试修改
cargo doc  # 生成测试文档
cargo run -- # 应用你的修改
open target/doc/cargo_doc_viewer/index.html  # 验证结果

# 测试撤销功能
cargo run -- --revert
```

### 修改 UI 组件 Modifying UI Components

- **样式修改** - 编辑 `main.rs` 中的 `CDV_CSS` 常量
- **功能修改** - 编辑 `main.rs` 中的 `CDV_JS` 常量
- **新增功能** - 遵循现有的自包含 JavaScript 模块模式

### 提交指南 Contribution Guidelines

1. Fork 仓库并创建功能分支
2. 确保代码通过 `cargo check` 和 `cargo clippy`
3. 测试增强和撤销功能都能正常工作
4. 提交 PR 并描述你的更改

## 📄 许可证 License

本项目采用 MIT 或 Apache-2.0 双重许可证。

This project is licensed under either of:
- Apache License, Version 2.0 ([LICENSE-APACHE](LICENSE-APACHE))
- MIT License ([LICENSE-MIT](LICENSE-MIT))

## 🙏 致谢 Acknowledgments

- 感谢 Rust 团队提供出色的 rustdoc 工具
- 感谢所有贡献者和用户的反馈

---

**如果这个工具对你有帮助，请给个 ⭐️ 支持一下！**

**If this tool helps you, please give it a ⭐️!**